#include "iostm8s103f3.h"
#include "led.h"

void LED_Init(void)
{
	PB_DDR |= 0x20;
	PB_CR1 |= 0x20;
	PB_CR2 |= 0x00;
	//GPIO_Init(LED_RED_PORT,   (GPIO_Pin_TypeDef)LED_RED_PINS,   GPIO_MODE_OUT_PP_LOW_FAST);
	//GPIO_Init(LED_GREEN_PORT, (GPIO_Pin_TypeDef)LED_GREEN_PINS, GPIO_MODE_OUT_PP_LOW_FAST);
	//GPIO_Init(LED_BLUE_PORT,  (GPIO_Pin_TypeDef)LED_BLUE_PINS,  GPIO_MODE_OUT_PP_LOW_FAST);
	PC_DDR |= 0xd0;
	PC_CR1 |= 0xd0;
	PC_CR2 |= 0xd0;
	//TIM1_OC1Init(TIM1_OCMODE_PWM1,TIM1_OUTPUTSTATE_ENABLE,TIM1_OUTPUTNSTATE_DISABLE,\
	500,TIM1_OCPOLARITY_LOW,TIM1_OCNPOLARITY_LOW,TIM1_OCIDLESTATE_SET,TIM1_OCNIDLESTATE_RESET);
	TIM1_CCMR1 = 0x60;
	TIM1_CCER1 &= ~0x0f;
	TIM1_CCER1 |= 0x0b;
	TIM1_CCR1H = 0x01;
	TIM1_CCR1L = 0xf4;
	//TIM1_OISR |= 0x01;
	TIM1_OISR &= ~0x03;
	TIM1_OISR |= 0x01;
	//TIM1_OC2Init(TIM1_OCMODE_PWM1,TIM1_OUTPUTSTATE_ENABLE,TIM1_OUTPUTNSTATE_DISABLE,\
    500,TIM1_OCPOLARITY_LOW,TIM1_OCNPOLARITY_LOW,TIM1_OCIDLESTATE_SET,TIM1_OCNIDLESTATE_RESET);
	TIM1_CCMR2 = 0x60;
	TIM1_CCER1 &= ~0xf0;
	TIM1_CCER1 |= 0xb0;
	TIM1_CCR2H = 0x01;
	TIM1_CCR2L = 0xf4;
	//TIM1_OISR |= 0x04;
	TIM1_OISR &= ~0xc0;
	TIM1_OISR |= 0x04;
	//TIM1_OC4Init(TIM1_OCMODE_PWM1,TIM1_OUTPUTSTATE_ENABLE,500,TIM1_OCPOLARITY_LOW,TIM1_OCIDLESTATE_SET);
	TIM1_CCMR4 = 0x60;
	TIM1_CCER2 |= 0x30;
	TIM1_CCR4H = 0x01;
	TIM1_CCR4L = 0xf4;
	TIM1_OISR &= ~0x40;
	//TIM1_CCxCmd(TIM1_CHANNEL_1, ENABLE);
	//TIM1_CCxCmd(TIM1_CHANNEL_2, ENABLE);
	//TIM1_CCxCmd(TIM1_CHANNEL_4, ENABLE);
	TIM1_CCER1 |= 0x01;
	TIM1_CCER1 |= 0x10;
	TIM1_CCER2 |= 0x10;
	//TIM1_OC1PreloadConfig(ENABLE);
	//TIM1_OC2PreloadConfig(ENABLE);
	//TIM1_OC4PreloadConfig(ENABLE);
	TIM1_CCMR1 |= 0x08;
	TIM1_CCMR2 |= 0x08;
	TIM1_CCMR4 |= 0x08;
}

void LED_All_ON(void)
{
  PC_ODR |= 0xd0;
}

void LED_All_OFF(void)
{
  PC_ODR &= ~0xd0;
}

void LED_RED_ON(void)
{
        TIM1_CCER1 |= 0x01;
	TIM1_CCER1 &= ~0x10;
	TIM1_CCER2 &= ~0x10;
}

void LED_GREEN_ON(void)
{
        TIM1_CCER1 &= ~0x01;
	TIM1_CCER1 |= 0x10;
	TIM1_CCER2 &= ~0x10;
}

void LED_BLUE_ON(void)
{
        TIM1_CCER1 &= ~0x01;
	TIM1_CCER1 &= ~0x10;
	TIM1_CCER2 |= 0x10;
}